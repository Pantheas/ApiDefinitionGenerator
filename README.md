# C# source generator 
Create API definition classes from controllers


## Example
Controller
```c#
public enum CupPreferredLiquid { Tea, Coffee }

public record Cup(int Id, string Name, CupPreferredLiquid PreferredLiquid);

public record CreateCupRequest(string Name, CupPreferredLiquid PreferredLiquid);

[Route("cups")]
[ApiController]
public class CupsController : ControllerBase
{
    private static readonly List<Cup> _cups = new();

    private static int _maxId = 1;

    [HttpGet]
    public ActionResult<Cup[]> GetAllCups()
    {
        return _cups.ToArray();
    }

    [HttpDelete("{id}")]
    public IActionResult DeleteCup(int id)
    {
        var cup = _cups.FirstOrDefault(c => c.Id == id);

        if (cup != null)
        {
            _cups.Remove(cup);
        }

        return NoContent();
    }

    [HttpPost]
    public ActionResult<Cup> CreateCup(CreateCupRequest request)
    {
        var nextId = _maxId++;

        var cup = new Cup(nextId, request.Name, request.PreferredLiquid);
        _cups.Add(cup);

        return cup;
    }
}
```

Generated API definition
```c#
// generated by Pantheas.ApiDefinitionGenerator.Generator
using System.Net.Http;
namespace Pantheas.CupsApi.Generated.Definition;
public class CupsDefinition
{
    public class GetAllCups
    {
        public string Route { get; }
        public HttpMethod Method { get; }
        public GetAllCups()
        {
            Route = "cups";
            Method = new HttpMethod("GET");
        }
    }
    public class DeleteCup
    {
        public string Route { get; }
        public HttpMethod Method { get; }
        public DeleteCup(int id)
        {
            Route = $"cups/{id}";
            Method = new HttpMethod("DELETE");
        }
    }
    public class CreateCup
    {
        public string Route { get; }
        public HttpMethod Method { get; }
        public CreateCup()
        {
            Route = "cups";
            Method = new HttpMethod("POST");
        }
    }
}
```


Usage in client app
```c#
using Pantheas.CupsApi.Generated.Definition;
public class CupsService
{
    private readonly IHttpClientProvider _httpClientProvider;

    public async Task<IEnumerable<Cup>> GetCupsAsync()
    {
        var definition = new CupsDefinition.GetAllCups();

        var request = new HttpRequestMessage
        {
            HttpMethod = definition.HttpMethod,
            
            RequestUri = new Uri(
                definition.Route,
                UriKind.Relative)    
        };

        var httpClient = await _httpClientProvider.GetClientAsync();

        var responseMessage = await httpClient.SendAsync(
            request);

        // handle response
        // ...
    }

    public async Task<bool> DeleteCupAsync(
        int id)
    {
        var definition = new CupsDefinition.DeleteCup(
            id);

        var request = new HttpRequestMessage
        {
            HttpMethod = definition.HttpMethod,
            
            RequestUri = new Uri(
                definition.Route,
                UriKind.Relative)    
        };

        var httpClient = await _httpClientProvider.GetClientAsync();

        var responseMessage = await httpClient.SendAsync(
            request);

        // handle response
        // ...
    }
}
```